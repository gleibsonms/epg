- name: Download remote EPG
  run: |
    echo "Baixando EPG remoto a partir de secret EPG_URL..."
    # tenta baixar para epg_remote.xml; falha se status != 200
    curl -fsSL "${{ secrets.EPG_URL }}" -o epg_remote.xml
    echo "Tamanho do arquivo epg_remote.xml:"
    wc -c epg_remote.xml || true

- name: Run EPG generator (using remote EPG)
  run: |
    echo "Rodando gerador com EPG remoto (epg_remote.xml) e M3U local (lista.m3u)..."
    ls -la
    # execute o seu script, apontando para o EPG remoto como input e escrevendo epg.xml como saída
    python3 epg_generator.py --m3u lista.m3u --epg epg_remote.xml --out epg.xml
  env:
    TZ: UTC

- name: Commit and push epg.xml if changed
  run: |
    git config user.name "github-actions[bot]"
    git config user.email "github-actions[bot]@users.noreply.github.com"
    git add epg.xml || true
    # commit só se houver alterações
    git diff --staged --quiet || ( git commit -m "Atualiza epg.xml (automático)" && git push )
  env:
    # GITHUB_TOKEN já está disponível automaticamente nas Actions; actions/checkout deve preservar credenciais
    GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
